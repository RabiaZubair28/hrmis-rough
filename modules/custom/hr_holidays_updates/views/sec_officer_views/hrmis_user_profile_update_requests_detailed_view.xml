<odoo>
<template id="hrmis_profile_update_request_view" name="Approve Profile Request Form">
    <t t-call="hr_holidays_updates.hrmis_ui_layout">

        <div class="hrmis-panel">
            <!-- Breadcrumb -->
            <div class="hrmis-breadcrumb">
                <a t-att-href="'/hrmis/profile-update-requests'">&lt; Back to Requests</a>
            </div>
            <!-- Header -->
            <div class="hrmis-panel__header">
                <div class="hrmis-panel__title">Approve Profile Update Request</div>
            </div>

            <!-- Body -->
            <div class="hrmis-panel__body">
                <t t-if="error_msg">
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>Error:</strong>
                        <t t-esc="error_msg"/>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                </t>

                <t t-if="success_msg">
                    <div class="alert alert-success alert-dismissible fade show" role="alert">
                        <strong>Success:</strong>
                        <t t-esc="success_msg"/>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                </t>

                <t t-if="info_msg">
                    <div class="alert alert-info alert-dismissible fade show" role="alert">
                        <strong>Info:</strong>
                        <t t-esc="info_msg"/>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                </t>
                <form class="hrmis-form"
                      t-att-action="'/hrmis/profile/request/approve/%s' % req.id"
                      method="post">

                    <input type="hidden" name="csrf_token"
                           t-att-value="request.csrf_token()"/>

                    <div class="hrmis-form__grid">

                        <!-- Employee / Service Info -->
                        <div class="hrmis-field">
                            <label>Employee ID / Service No</label>
                            <input class="hrmis-input"
                                   type="text"
                                   name="hrmis_employee_id"
                                   t-att-value="req.hrmis_employee_id"/>
                        </div>

                        <div class="hrmis-field">
                            <label>CNIC</label>
                            <input class="hrmis-input"
                                   type="text"
                                   name="hrmis_cnic"
                                   t-att-value="req.hrmis_cnic"/>
                        </div>

                        <!-- Personal -->
                        <div class="hrmis-field">
                            <label>Father's Name</label>
                            <input class="hrmis-input"
                                   type="text"
                                   name="hrmis_father_name"
                                   t-att-value="req.hrmis_father_name"/>
                        </div>

                        <div class="hrmis-field">
                            <label>Gender</label>
                            <select class="hrmis-input" name="gender">
                                <option value="male" t-att-selected="req.gender=='male'">Male</option>
                                <option value="female" t-att-selected="req.gender=='female'">Female</option>
                            </select>
                        </div>


                        <div class="hrmis-field">
                            <label>Date of Birth</label>
                            <input class="hrmis-input"
                                   type="date"
                                   name="birthday"
                                   t-att-value="req.birthday"/>
                        </div>


                        <div class="hrmis-field">
                            <label>Commision Date</label>
                            <input class="hrmis-input"
                                   type="date"
                                   name="hrmis_commission_date"
                                   t-att-value="req.hrmis_commission_date"/>
                        </div>

                        <!-- Service -->
                        <div class="hrmis-field">
                            <label>Joining Date</label>
                            <input class="hrmis-input"
                                   type="date"
                                   name="hrmis_joining_date"
                                   t-att-value="req.hrmis_joining_date"/>
                        </div>
                        <!-- Posting -->
                        <div class="hrmis-field">
                            <label>District</label>
                            <select class="hrmis-input js-hrmis-district" name="district_id" required="required">
                                <option value="">Select</option>
                                <t t-foreach="districts" t-as="dist">
                                    <option t-att-value="dist.id"
                                            t-att-selected="req.district_id and req.district_id.id == dist.id">
                                        <t t-esc="dist.name"/>
                                    </option>
                                </t>
                            </select>
                        </div>

                        <div class="hrmis-field">
                            <label>Facility</label>
                            <select class="hrmis-input js-hrmis-facility" name="facility_id" required="required">
                                <option value="">Select</option>
                                <t t-foreach="facilities" t-as="fac">
                                    <option t-att-value="fac.id"
                                            t-att-data-district-id="fac.district_id.id if fac.district_id else ''"
                                            t-att-selected="req.facility_id and req.facility_id.id == fac.id">
                                        <t t-esc="fac.name"/>
                                    </option>
                                </t>
                            </select>
                        </div>

                        <div class="hrmis-field">
                            <label>Cadre</label>
                            <select class="hrmis-input" name="hrmis_cadre">
                                <option value="">Select</option>
                                <t t-foreach="cadres" t-as="cadre">
                                    <option t-att-value="cadre.id"
                                            t-att-selected="req.hrmis_cadre and req.hrmis_cadre.id == cadre.id">
                                        <t t-esc="cadre.name"/>
                                    </option>
                                </t>
                            </select>
                        </div>

                        <div class="hrmis-field">
                            <label>BPS Grade</label>
                            <input class="hrmis-input js-hrmis-bps"
                                type="number"
                                name="hrmis_bps"
                                t-att-value="req.hrmis_bps"/>
                        </div>

                        <!-- Designation -->
                        <div class="hrmis-field">
                            <label>Designation<span class="req">*</span></label>
                            <select class="hrmis-input js-designation-select" name="hrmis_designation" required="required">
                                <option value="">Select</option>
                                <t t-foreach="designations" t-as="designation">
                                    <t t-set="rem"
                                        t-value="remaining_map.get((designation.facility_id.id, designation.id), designation.total_sanctioned_posts or 0)"/>

                                        <option t-att-value="designation.id"
                                                t-att-data-facility-id="designation.facility_id.id if designation.facility_id else ''"
                                                t-att-data-bps="designation.post_BPS"
                                                t-att-data-total="designation.total_sanctioned_posts"
                                                t-att-data-remaining="rem"
                                                t-att-style="'color:#c62828;' if (rem or 0) == 0 else ''"
                                                t-att-selected="req.hrmis_designation and req.hrmis_designation.id == designation.id">
                                            <t t-esc="designation.name"/>
                                            <t t-esc="'  (%s/%s)' % (rem or 0, designation.total_sanctioned_posts or 0)"/>
                                        </option>

                                </t>
                            </select>


                        </div>

                        <div class="hrmis-field">
                            <label>Total Leaves Taken Since Joining (Days)</label>
                            <input class="hrmis-input"
                                   type="numbner"
                                   steps="0.1"
                                   name="hrmis_leaves_taken"
                                   t-att-value="req.hrmis_leaves_taken"/>
                        </div>

                        <!-- Contact -->
                        <div class="hrmis-field hrmis-field--wide">
                            <label>Contact Info</label>
                            <input class="hrmis-input hrmis-input--wide"
                                   type="text"
                                   name="hrmis_contact_info"
                                   t-att-value="req.hrmis_contact_info"/>
                        </div>

                    </div>

                    <!-- Actions -->
                    <div class="hrmis-form__actions" t-if="can_approve">
                        <button type="submit"
                                name="approve"
                                class="hrmis-btn hrmis-btn--primary hrmis-btn--lg">
                            Approve
                        </button>

                        <a class="hrmis-btn hrmis-btn--outline"
                           t-att-href="back_url">
                            Back
                        </a>
                    </div>

                </form>

            </div>
        </div>

    </t>
</template>
</odoo>
