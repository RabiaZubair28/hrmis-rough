<odoo>
  <template id="hrmis_ui_layout_section_officer_search_staff"
            inherit_id="hr_holidays_updates.hrmis_ui_layout">
    <xpath expr="(//nav[contains(@class,'hrmis-nav')]//a)[1]" position="after">
      <t t-if="request.env.user.has_group('custom_login.group_section_officer')">
        <a t-attf-class="hrmis-nav__item #{'is-active' if active_menu == 'staff' else ''}"
           href="/hrmis/staff">
          Search staff
        </a>
      </t>
    </xpath>
  </template>

  <template id="hrmis_staff_search" name="HRMIS Staff Search">
    <t t-if="not request.env.user.has_group('custom_login.group_hrmis_employee_self')">
      <t t-call="hr_holidays_updates.hrmis_ui_layout">

        <div class="hrmis-panel">
          <div class="hrmis-panel__header">
            <div class="hrmis-panel__title">Search staff</div>
          </div>

          <div class="hrmis-panel__body">
            <form class="hrmis-form hrmis-search-form">

              <div class="hrmis-search-field">
                <label>Name</label>
                <input class="hrmis-input"
                       type="text"
                       name="name"
                       t-att-value="name"
                       placeholder="Type Name..."/>
              </div>

              <div class="hrmis-search-field">
                <label>CNIC</label>
                <input class="hrmis-input"
                       type="text"
                       name="cnic"
                       t-att-value="cnic"
                       placeholder="Type CNIC..."/>
              </div>

              <div class="hrmis-search-field">
                <label>Designation</label>
                <select name="designation" class="hrmis-select">
                  <option value="">Select Designation</option>
                  <t t-foreach="designations" t-as="d">
                    <option t-att-value="d.name" t-att-selected="d.name == designation">
                      <t t-esc="d.name"/>
                    </option>
                  </t>
                </select>
              </div>

              <div class="hrmis-search-field">
                <label>District</label>
                <select name="district" class="hrmis-select">
                  <option value="">Select District</option>
                  <t t-foreach="districts" t-as="d">
                    <option t-att-value="d.name" t-att-selected="d.name == district">
                      <t t-esc="d.name"/>
                    </option>
                  </t>
                </select>
              </div>

              <div class="hrmis-search-field">
                <label>Facility</label>
                <select name="facility" class="hrmis-select">
                  <option value="">Select Facility</option>
                  <t t-foreach="facilities" t-as="f">
                    <option t-att-value="f.name" t-att-selected="f.name == facility">
                      <t t-esc="f.name"/>
                    </option>
                  </t>
                </select>
              </div>

              <!-- Search button (same submit behavior, only UI improved) -->
              <div class="hrmis-search-field hrmis-search-field--btn">
                <label class="hrmis-search-label--ghost">Search</label>
                <button type="submit" class="hrmis-btn hrmis-btn--icon" title="Search">
                  <i class="fa fa-search"></i>
                </button>
              </div>

            </form>
          </div>
        </div>

        <div class="hrmis-panel" t-if="name or cnic or designation or district or facility">
          <div class="hrmis-panel__header">
            <div class="hrmis-panel__title">Search results</div>

            <div class="hrmis-panel__header">
              <div>
                <div t-if="employees">
                  <a t-attf-href="/hrmis/staff/export?name={{ name or '' }}&amp;cnic={{ cnic or '' }}&amp;designation={{ designation or '' }}&amp;district={{ district or '' }}&amp;facility={{ facility or '' }}"
                     class="hrmis-btn hrmis-btn--primary">
                    <i class="fa fa-download"></i>
                    <span>Export Results</span>
                  </a>
                </div>
              </div>
            </div>

          </div>

          <div class="hrmis-panel__body">

            <t t-if="not employees">
              <div class="hrmis-empty">No staff found.</div>
            </t>

            <t t-foreach="employees" t-as="emp">
              <div class="hrmis-result">
                <div class="hrmis-result__avatar">
                  <img t-att-alt="emp.name"
                       t-att-src="'/web/image/hr.employee.public/%s/avatar_1024/' % emp.id"/>
                </div>

                <div class="hrmis-result__meta">
                  <div class="hrmis-result__name">
                    <t t-esc="emp.name"/>

                    <t t-if="emp.job_id">
                      — <t t-esc="emp.job_id.name"/>
                    </t>
                    <t t-if="emp.hrmis_designation">
                      — <t t-esc="emp.hrmis_designation.name"/>
                    </t>
                    <t t-if="emp.hrmis_bps">
                      , BPS <t t-esc="emp.hrmis_bps"/>
                    </t>
                  </div>

                  <div class="hrmis-result__sub">
                    <div class="hrmis-result__sub">
                      <t t-if="emp.facility_id"><t t-esc="emp.facility_id.name"/></t>
                      <t t-if="emp.facility_id and emp.district_id"> · </t>
                      <t t-if="emp.district_id"><t t-esc="emp.district_id.name"/></t>
                    </div>
                  </div>
                </div>

                <a t-att-href="'/hrmis/manage/history/%s?tab=profile&amp;name=%s&amp;cnic=%s&amp;designation=%s&amp;district=%s&amp;facility=%s' % (
                      emp.id,
                      name or '',
                      cnic or '',
                      designation or '',
                      district or '',
                      facility or ''
                    )"
                   class="btn btn-outline-secondary mt4">
                  View Profile
                </a>

              </div>
            </t>

          </div>
        </div>

      </t>
    </t>
  </template>

  <template id="hrmis_manage_history_back_to_staff"
            inherit_id="hrmis_manage_history">

    <xpath expr="//div[contains(@class,'hrmis-form__actions')]/a" position="replace">
      <a class="hrmis-btn hrmis-btn--outline"
         t-attf-href="/hrmis/staff?name={{ request.session.get('staff_search_filters', {}).get('name','') }}&amp;cnic={{ request.session.get('staff_search_filters', {}).get('cnic','') }}&amp;designation={{ request.session.get('staff_search_filters', {}).get('designation','') }}&amp;district={{ request.session.get('staff_search_filters', {}).get('district','') }}&amp;facility={{ request.session.get('staff_search_filters', {}).get('facility','') }}">
        Back to Staff Search
      </a>
    </xpath>

  </template>
</odoo>
