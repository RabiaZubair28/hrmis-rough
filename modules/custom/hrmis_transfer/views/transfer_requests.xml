<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Inherit the existing HRMIS Transfer Requests shell to add the extra tabs -->
    <template id="hrmis_transfer_requests_inherit_tabs" inherit_id="hr_holidays_updates.hrmis_transfer_requests">
        <xpath expr="//div[contains(@class,'hrmis-panel__header') and contains(@class,'hrmis-panel__header--tabs')]" position="replace">
            <div class="hrmis-panel__header hrmis-panel__header--tabs hrmis-panel__header--tabs--leave">
                <a t-attf-class="hrmis-tab #{'is-active' if tab == 'requests' else ''}"
                   t-att-href="'/hrmis/transfer?tab=requests'">Transfer Requests</a>
                <a t-attf-class="hrmis-tab #{'is-active' if tab == 'new' else ''}"
                   t-att-href="'/hrmis/transfer?tab=new'">New Transfer Request</a>
                <a t-attf-class="hrmis-tab #{'is-active' if tab == 'status' else ''}"
                   t-att-href="'/hrmis/transfer?tab=status'">Transfer Status</a>
                <a t-attf-class="hrmis-tab #{'is-active' if tab == 'history' else ''}"
                   t-att-href="'/hrmis/transfer?tab=history'">Transfer History</a>
            </div>
        </xpath>

        <!-- Render content for requests/status tabs (base template only renders a body for history) -->
        <xpath expr="//div[contains(@class,'hrmis-panel__header') and contains(@class,'hrmis-panel__header--tabs')]" position="after">
            <t t-if="tab == 'requests'">
                <div class="hrmis-panel__body">
                    <t t-call="hrmis_transfer.hrmis_transfer_requests_list"/>
                </div>
            </t>
            <t t-if="tab == 'status'">
                <div class="hrmis-panel__body">
                    <t t-call="hrmis_transfer.hrmis_transfer_status"/>
                </div>
            </t>
        </xpath>

        <xpath expr="//t[@t-if=&quot;tab == 'history'&quot;]" position="replace">
            <t t-if="tab == 'history'">
                <div class="hrmis-panel__body">
                    <t t-call="hrmis_transfer.hrmis_transfer_history"/>
                </div>
            </t>
        </xpath>

        <xpath expr="//t[@t-if=&quot;tab == 'new'&quot;]" position="replace">
            <t t-if="tab == 'new'">
                <t t-call="hrmis_transfer.hrmis_new_transfer_request"/>
            </t>
        </xpath>
    </template>

    <template id="hrmis_transfer_requests_list" name="HRMIS: Transfer Requests List">
        <t t-set="error" t-value="request.params.get('error')"/>
        <t t-set="success" t-value="request.params.get('success')"/>
        <t t-set="emp_ids" t-value="request.env['hr.employee'].sudo().search([('user_id','=',request.env.user.id)]).ids"/>
        <t t-set="transfers"
           t-value="(emp_ids and request.env['hrmis.transfer.request'].sudo().search([('employee_id','in',emp_ids)], order='create_date desc, id desc', limit=50)) or request.env['hrmis.transfer.request'].browse([])"/>
        <div class="hrmis-panel__body">
            <t t-if="error">
                <div class="hrmis-alert hrmis-alert--error"><t t-esc="error"/></div>
            </t>
            <t t-if="success">
                <div class="hrmis-alert hrmis-alert--success"><t t-esc="success"/></div>
            </t>
            <t t-if="not transfers">
                <div class="hrmis-empty">No transfer requests found.</div>
            </t>
            <t t-else="">
                <div class="hrmis-table">
                    <div class="hrmis-table__head">
                        <div>#</div>
                        <div>Submitted on</div>
                        <div>Current Posting</div>
                        <div>Required Posting</div>
                        <div>Status</div>
                        <div>Pending With</div>
                    </div>
                    <t t-foreach="range(len(transfers))" t-as="idx0">
                        <t t-set="tr" t-value="transfers[idx0]"/>
                        <div class="hrmis-table__row">
                            <div><t t-esc="idx0 + 1"/></div>
                            <div><t t-esc="tr.submitted_on or tr.create_date"/></div>
                            <div>
                                <t t-esc="(tr.current_facility_id and tr.current_facility_id.name) or ''"/>
                                <div class="sub" style="color:#666;">
                                    <t t-esc="(tr.current_district_id and tr.current_district_id.name) or ''"/>
                                </div>
                            </div>
                            <div>
                                <t t-esc="(tr.required_facility_id and tr.required_facility_id.name) or ''"/>
                                <div class="sub" style="color:#666;">
                                    <t t-esc="(tr.required_district_id and tr.required_district_id.name) or ''"/>
                                </div>
                            </div>
                            <div>
                                <t t-if="tr.state == 'draft'">Draft</t>
                                <t t-elif="tr.state == 'submitted'">Pending</t>
                                <t t-elif="tr.state == 'approved'">Approved</t>
                                <t t-elif="tr.state == 'rejected'">Rejected</t>
                                <t t-else=""><t t-esc="tr.state"/></t>
                            </div>
                            <div><t t-esc="tr.pending_with or '-'"/></div>
                        </div>
                    </t>
                </div>
            </t>
        </div>
    </template>
</odoo>